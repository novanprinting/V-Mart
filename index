<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toko Online</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Poppins', sans-serif; }
    .product-card:hover { transform: translateY(-8px); }
    .product-card { transition: all 0.3s ease; }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .slide-in { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .cart-badge { animation: pop 0.3s ease-out; }
    @keyframes pop {
      0% { transform: scale(0); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .toast {
      animation: toastIn 0.3s ease-out, toastOut 0.3s ease-in 2.7s forwards;
    }
    @keyframes toastIn {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes toastOut {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(100px); opacity: 0; }
    }
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full bg-slate-50 overflow-auto">
  <div id="app" class="h-full w-full min-h-full flex flex-col"><!-- Header -->
   <header id="header" class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-lg sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-3"><!-- Top Bar -->
     <div class="flex items-center justify-between mb-3">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
        <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 24 24"><path d="M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3zm7 17H5V8h2v2c0 .55.45 1 1 1s1-.45 1-1V8h6v2c0 .55.45 1 1 1s1-.45 1-1V8h2v12z" />
        </svg>
       </div>
       <div>
        <h1 id="store-name" class="text-xl font-bold">StyleShop</h1>
        <p id="welcome-text" class="text-xs text-white/80">Temukan gaya terbaikmu</p>
       </div>
      </div><button id="cart-btn" onclick="toggleCart()" class="relative bg-white/20 hover:bg-white/30 p-3 rounded-xl transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
       </svg><span id="cart-count" class="absolute -top-1 -right-1 bg-rose-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold hidden cart-badge">0</span> </button>
     </div><!-- Search Bar -->
     <div class="relative"><input type="text" id="search-input" placeholder="Cari produk favorit..." class="w-full px-4 py-3 pl-12 rounded-xl bg-white/20 placeholder-white/70 text-white border border-white/30 focus:outline-none focus:bg-white/30 focus:border-white/50 transition-all" oninput="searchProducts(this.value)">
      <svg class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2 text-white/70" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
     </div>
    </div><!-- Promo Banner -->
    <div id="promo-banner" class="bg-gradient-to-r from-amber-400 to-orange-400 text-amber-900 py-2 px-4 text-center text-sm font-medium"><span id="promo-text">?? Gratis Ongkir untuk pembelian di atas Rp500.000!</span>
    </div>
   </header><!-- Category Tabs -->
   <nav class="bg-white shadow-sm sticky top-[140px] z-30">
    <div class="max-w-7xl mx-auto px-4">
     <div class="flex gap-2 py-3 overflow-x-auto scrollbar-hide"><button onclick="filterCategory('all')" data-category="all" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-emerald-600 text-white whitespace-nowrap transition-all"> Semua </button> <button onclick="filterCategory('fashion')" data-category="fashion" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-all"> ?? Fashion </button> <button onclick="filterCategory('elektronik')" data-category="elektronik" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-all"> ?? Elektronik </button> <button onclick="filterCategory('aksesoris')" data-category="aksesoris" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-all"> ? Aksesoris </button> <button onclick="filterCategory('sepatu')" data-category="sepatu" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 whitespace-nowrap transition-all"> ?? Sepatu </button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="flex-1 max-w-7xl mx-auto px-4 py-6 w-full"><!-- Products Grid -->
    <div id="products-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"><!-- Products will be rendered here -->
    </div><!-- Empty State -->
    <div id="empty-state" class="hidden text-center py-16">
     <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-12 h-12 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
     </div>
     <h3 class="text-lg font-semibold text-slate-700 mb-2">Produk tidak ditemukan</h3>
     <p class="text-slate-500">Coba kata kunci lain atau lihat kategori lainnya</p>
    </div>
   </main><!-- Cart Sidebar -->
   <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-50 hidden" onclick="toggleCart()"></div>
   <aside id="cart-sidebar" class="fixed right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl z-50 translate-x-full transition-transform duration-300 flex flex-col"><!-- Cart Header -->
    <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-4 flex items-center justify-between">
     <div class="flex items-center gap-3">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <h2 class="text-lg font-bold">Keranjang Belanja</h2>
     </div><button onclick="toggleCart()" class="p-2 hover:bg-white/20 rounded-lg transition-all">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div><!-- Cart Items -->
    <div id="cart-items" class="flex-1 overflow-y-auto p-4"><!-- Cart items will be rendered here -->
    </div><!-- Cart Empty State -->
    <div id="cart-empty" class="flex-1 flex flex-col items-center justify-center p-8 hidden">
     <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4">
      <svg class="w-10 h-10 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
      </svg>
     </div>
     <h3 class="text-lg font-semibold text-slate-700 mb-2">Keranjang Kosong</h3>
     <p class="text-slate-500 text-center text-sm">Yuk, mulai belanja dan temukan produk favoritmu!</p><button onclick="toggleCart()" class="mt-4 px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-all"> Mulai Belanja </button>
    </div><!-- Cart Footer -->
    <div id="cart-footer" class="border-t p-4 bg-slate-50 hidden">
     <div class="space-y-2 mb-4">
      <div class="flex justify-between text-slate-600"><span>Subtotal</span> <span id="subtotal">Rp 0</span>
      </div>
      <div class="flex justify-between text-slate-600"><span>Ongkos Kirim</span> <span id="shipping">Rp 0</span>
      </div>
      <div class="flex justify-between text-lg font-bold text-slate-800 pt-2 border-t"><span>Total</span> <span id="total">Rp 0</span>
      </div>
     </div><button id="checkout-btn" onclick="showCheckout()" class="w-full py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl font-bold hover:shadow-lg hover:scale-[1.02] transition-all"> Checkout Sekarang </button>
    </div>
   </aside><!-- Checkout Modal -->
   <div id="checkout-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full max-h-[90%] overflow-y-auto slide-in"><!-- Checkout Header -->
     <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-4 rounded-t-2xl flex items-center justify-between">
      <h2 class="text-lg font-bold">Checkout</h2><button onclick="closeCheckout()" class="p-2 hover:bg-white/20 rounded-lg transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div><!-- Checkout Form -->
     <form id="checkout-form" class="p-6 space-y-4" onsubmit="processCheckout(event)">
      <div><label class="block text-sm font-medium text-slate-700 mb-1">Nama Lengkap</label> <input type="text" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="Masukkan nama lengkap">
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-1">Nomor Telepon</label> <input type="tel" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="08xxxxxxxxxx">
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-1">Alamat Pengiriman</label> <textarea required rows="3" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none" placeholder="Masukkan alamat lengkap"></textarea>
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-2">Metode Pembayaran</label>
       <div class="space-y-2"><label class="flex items-center gap-3 p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all"> <input type="radio" name="payment" value="transfer" checked class="w-4 h-4 text-emerald-600"> <span class="text-2xl">??</span> <span class="font-medium">Transfer Bank</span> </label> <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all"> <input type="radio" name="payment" value="ewallet" class="w-4 h-4 text-emerald-600"> <span class="text-2xl">??</span> <span class="font-medium">E-Wallet</span> </label> <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all"> <input type="radio" name="payment" value="cod" class="w-4 h-4 text-emerald-600"> <span class="text-2xl">??</span> <span class="font-medium">COD (Bayar di Tempat)</span> </label>
       </div>
      </div><!-- Order Summary -->
      <div class="bg-slate-50 rounded-xl p-4">
       <h3 class="font-semibold text-slate-700 mb-3">Ringkasan Pesanan</h3>
       <div id="checkout-summary" class="space-y-2 text-sm text-slate-600 mb-3"><!-- Summary will be rendered here -->
       </div>
       <div class="flex justify-between text-lg font-bold text-slate-800 pt-3 border-t border-slate-200"><span>Total Pembayaran</span> <span id="checkout-total">Rp 0</span>
       </div>
      </div><button type="submit" id="place-order-btn" class="w-full py-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:scale-[1.02] transition-all"> Buat Pesanan </button>
     </form>
    </div>
   </div><!-- Success Modal -->
   <div id="success-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-sm w-full text-center p-8 slide-in">
     <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-10 h-10 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
      </svg>
     </div>
     <h2 class="text-2xl font-bold text-slate-800 mb-2">Pesanan Berhasil! ??</h2>
     <p class="text-slate-600 mb-6">Terima kasih telah berbelanja. Pesanan Anda sedang diproses.</p><button onclick="closeSuccess()" class="px-8 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl font-bold hover:shadow-lg transition-all"> Lanjut Belanja </button>
    </div>
   </div><!-- Toast Container -->
   <div id="toast-container" class="fixed bottom-4 left-4 right-4 z-50 flex flex-col items-center gap-2 pointer-events-none"></div>
  </div>
  <script>
    // Product Data
    const products = [
      { id: 'p1', name: 'Kemeja Premium Oxford', description: 'Kemeja formal berkualitas tinggi dengan bahan oxford 100% katun, nyaman dipakai untuk acara formal maupun casual', price: 299000, originalPrice: 450000, category: 'fashion', rating: 4.8, sold: 1250, image: '??', color: 'from-blue-400 to-indigo-500', photoUrl: 'https://images.unsplash.com/photo-1620012253295-c15cc7cb4c1d?w=400&h=400&fit=crop' },
      { id: 'p2', name: 'Wireless Earbuds Pro', description: 'Earbuds nirkabel dengan noise cancellation aktif, baterai tahan hingga 8 jam, kualitas audio premium dengan bass yang dalam', price: 549000, originalPrice: 799000, category: 'elektronik', rating: 4.9, sold: 3420, image: '??', color: 'from-purple-400 to-pink-500', photoUrl: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=400&fit=crop' },
      { id: 'p3', name: 'Smartwatch Fitness', description: 'Jam tangan pintar dengan fitur tracking kesehatan, monitor detak jantung, langkah kaki, kalori terbakar, dan sinkronisasi smartphone', price: 899000, originalPrice: 1299000, category: 'aksesoris', rating: 4.7, sold: 890, image: '?', color: 'from-cyan-400 to-blue-500', photoUrl: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&h=400&fit=crop' },
      { id: 'p4', name: 'Sneakers Running Elite', description: 'Sepatu lari profesional dengan bantalan empuk, breathable mesh, cocok untuk lari santai hingga maraton, desain ergonomis', price: 649000, originalPrice: 950000, category: 'sepatu', rating: 4.8, sold: 2100, image: '??', color: 'from-emerald-400 to-teal-500', photoUrl: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=400&fit=crop' },
      { id: 'p5', name: 'Jacket Denim Vintage', description: 'Jaket denim klasik dengan desain vintage, bahan tebal dan tahan lama, sempurna untuk gaya casual dan santai sehari-hari', price: 459000, originalPrice: 699000, category: 'fashion', rating: 4.6, sold: 750, image: '??', color: 'from-amber-400 to-orange-500', photoUrl: 'https://images.unsplash.com/photo-1551028719-00167b16ebc5?w=400&h=400&fit=crop' },
      { id: 'p6', name: 'Portable Charger 20000mAh', description: 'Power bank kapasitas besar 20000mAh dengan dual port USB, fast charging, indikator LED, untuk semua smartphone dan tablet', price: 299000, originalPrice: 450000, category: 'elektronik', rating: 4.8, sold: 5600, image: '??', color: 'from-rose-400 to-red-500', photoUrl: 'https://images.unsplash.com/photo-1609091839311-d5365f9ff1c5?w=400&h=400&fit=crop' },
      { id: 'p7', name: 'Kacamata Polarized UV', description: 'Kacamata hitam dengan lensa polarized full UV protection, anti silau, ringan dan nyaman dipakai untuk outdoor activities', price: 199000, originalPrice: 350000, category: 'aksesoris', rating: 4.5, sold: 1800, image: '???', color: 'from-slate-400 to-gray-500', photoUrl: 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=400&fit=crop' },
      { id: 'p8', name: 'Boots Kulit Premium', description: 'Sepatu boots kulit asli premium dengan desain klasik, kokoh dan tahan lama, cocok untuk berbagai kesempatan formal dan semi-formal', price: 899000, originalPrice: 1450000, category: 'sepatu', rating: 4.9, sold: 420, image: '??', color: 'from-yellow-600 to-amber-700', photoUrl: 'https://images.unsplash.com/photo-1543163521-1bf539c55dd2?w=400&h=400&fit=crop' },
      { id: 'p9', name: 'T-Shirt Oversize Cotton', description: 'Kaos oversize dari bahan katun 100% breathable, design minimalis modern, nyaman untuk aktivitas sehari-hari dan tidur', price: 149000, originalPrice: 250000, category: 'fashion', rating: 4.7, sold: 8900, image: '??', color: 'from-green-400 to-emerald-500', photoUrl: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=400&fit=crop' },
      { id: 'p10', name: 'Bluetooth Speaker Mini', description: 'Speaker portabel bluetooth kompak, kualitas suara jernih, baterai tahan 12 jam, waterproof dan cocok untuk outdoor', price: 349000, originalPrice: 550000, category: 'elektronik', rating: 4.6, sold: 2300, image: '??', color: 'from-violet-400 to-purple-500', photoUrl: 'https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=400&h=400&fit=crop' },
      { id: 'p11', name: 'Tas Ransel Anti Air', description: 'Ransel tahan air dengan desain ergonomis, banyak kompartemen, material berkualitas, cocok untuk travel dan pekerjaan', price: 399000, originalPrice: 650000, category: 'aksesoris', rating: 4.8, sold: 1650, image: '??', color: 'from-sky-400 to-blue-500', photoUrl: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=400&fit=crop' },
      { id: 'p12', name: 'Sandal Slide Premium', description: 'Sandal slip-on nyaman dengan bantalan empuk, material premium, desain trendy, cocok untuk santai dan hangout', price: 199000, originalPrice: 320000, category: 'sepatu', rating: 4.5, sold: 3200, image: '??', color: 'from-pink-400 to-rose-500', photoUrl: 'https://images.unsplash.com/photo-1565299624946-b28974c45efb?w=400&h=400&fit=crop' },
    ];

    // State
    let cartItems = [];
    let currentCategory = 'all';
    let searchQuery = '';
    let isLoading = false;

    // Config
    const defaultConfig = {
      store_name: 'StyleShop',
      welcome_text: 'Temukan gaya terbaikmu',
      promo_text: '?? Gratis Ongkir untuk pembelian di atas Rp500.000!',
      seller_phone: '628xxxxxxxxxx',
      primary_color: '#059669',
      secondary_color: '#ffffff',
      text_color: '#1e293b',
      accent_color: '#f59e0b',
      button_color: '#10b981',
      font_family: 'Poppins',
      font_size: 16
    };

    // Data Handler
    const dataHandler = {
      onDataChanged(data) {
        cartItems = data;
        updateCartUI();
      }
    };

    // Element SDK Implementation
    const element = {
      defaultConfig,
      async onConfigChange(config) {
        const storeName = config.store_name || defaultConfig.store_name;
        const welcomeText = config.welcome_text || defaultConfig.welcome_text;
        const promoText = config.promo_text || defaultConfig.promo_text;
        const primaryColor = config.primary_color || defaultConfig.primary_color;
        const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
        const textColor = config.text_color || defaultConfig.text_color;
        const accentColor = config.accent_color || defaultConfig.accent_color;
        const buttonColor = config.button_color || defaultConfig.button_color;
        const fontFamily = config.font_family || defaultConfig.font_family;
        const fontSize = config.font_size || defaultConfig.font_size;
        const sellerPhone = config.seller_phone || defaultConfig.seller_phone;

        // Update text content
        document.getElementById('store-name').textContent = storeName;
        document.getElementById('welcome-text').textContent = welcomeText;
        document.getElementById('promo-text').textContent = promoText;

        // Update colors
        const header = document.getElementById('header');
        header.style.background = `linear-gradient(to right, ${primaryColor}, ${adjustColor(primaryColor, 20)})`;

        const promoBanner = document.getElementById('promo-banner');
        promoBanner.style.background = `linear-gradient(to right, ${accentColor}, ${adjustColor(accentColor, 20)})`;

        // Update font
        document.body.style.fontFamily = `${fontFamily}, Poppins, sans-serif`;

        // Update font sizes
        document.getElementById('store-name').style.fontSize = `${fontSize * 1.25}px`;
        document.getElementById('welcome-text').style.fontSize = `${fontSize * 0.75}px`;
      },
      mapToCapabilities(config) {
        return {
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => { config.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => { config.secondary_color = value; window.elementSdk.setConfig({ secondary_color: value }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => { config.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
            },
            {
              get: () => config.button_color || defaultConfig.button_color,
              set: (value) => { config.button_color = value; window.elementSdk.setConfig({ button_color: value }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
          }
        };
      },
      mapToEditPanelValues(config) {
        return new Map([
          ['store_name', config.store_name || defaultConfig.store_name],
          ['welcome_text', config.welcome_text || defaultConfig.welcome_text],
          ['promo_text', config.promo_text || defaultConfig.promo_text],
          ['seller_phone', config.seller_phone || defaultConfig.seller_phone]
        ]);
      }
    };

    // Helper Functions
    function adjustColor(color, amount) {
      const hex = color.replace('#', '');
      const r = Math.min(255, parseInt(hex.slice(0, 2), 16) + amount);
      const g = Math.min(255, parseInt(hex.slice(2, 4), 16) + amount);
      const b = Math.min(255, parseInt(hex.slice(4, 6), 16) + amount);
      return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
    }

    function formatPrice(price) {
      return 'Rp ' + price.toLocaleString('id-ID');
    }

    function formatSold(sold) {
      if (sold >= 1000) {
        return (sold / 1000).toFixed(1) + 'rb';
      }
      return sold.toString();
    }

    function getDiscount(original, current) {
      return Math.round((1 - current / original) * 100);
    }

    // Render Products
    function renderProducts() {
      const grid = document.getElementById('products-grid');
      const emptyState = document.getElementById('empty-state');
      
      let filtered = products;
      
      if (currentCategory !== 'all') {
        filtered = filtered.filter(p => p.category === currentCategory);
      }
      
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(p => 
          p.name.toLowerCase().includes(query) || 
          p.category.toLowerCase().includes(query)
        );
      }

      if (filtered.length === 0) {
        grid.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }

      emptyState.classList.add('hidden');
      grid.innerHTML = filtered.map((product, index) => `
        <div class="product-card bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl fade-in cursor-pointer" onclick="showProductDetail('${product.id}')" style="animation-delay: ${index * 50}ms">
          <div class="relative">
            <img src="${product.photoUrl}" alt="${product.name}" loading="lazy" onerror="console.error('Image failed to load:', this.src); this.style.background='#e5e7eb'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.style.fontSize='3rem'; this.textContent='??';" class="w-full aspect-square object-cover bg-gradient-to-br ${product.color}">
            <span class="absolute top-2 left-2 bg-rose-500 text-white text-xs px-2 py-1 rounded-full font-bold">
              -${getDiscount(product.originalPrice, product.price)}%
            </span>
            <button onclick="event.stopPropagation(); addToCart('${product.id}')" class="absolute bottom-2 right-2 w-10 h-10 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-lg hover:bg-emerald-500 hover:text-white transition-all group">
              <svg class="w-5 h-5 text-emerald-600 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
            </button>
          </div>
          <div class="p-3">
            <h3 class="font-semibold text-slate-800 text-sm line-clamp-2 mb-1 leading-tight">${product.name}</h3>
            <p class="text-xs text-slate-500 line-clamp-2 mb-2">${product.description}</p>
            <div class="flex items-center gap-1 mb-2">
              <span class="text-amber-500 text-xs">?</span>
              <span class="text-xs text-slate-600">${product.rating}</span>
              <span class="text-xs text-slate-400">|</span>
              <span class="text-xs text-slate-500">${formatSold(product.sold)} terjual</span>
            </div>
            <div class="flex items-end gap-2">
              <span class="font-bold text-emerald-600">${formatPrice(product.price)}</span>
              <span class="text-xs text-slate-400 line-through">${formatPrice(product.originalPrice)}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Category Filter
    function filterCategory(category) {
      currentCategory = category;
      
      document.querySelectorAll('.category-btn').forEach(btn => {
        if (btn.dataset.category === category) {
          btn.classList.remove('bg-slate-100', 'text-slate-600', 'hover:bg-slate-200');
          btn.classList.add('bg-emerald-600', 'text-white');
        } else {
          btn.classList.add('bg-slate-100', 'text-slate-600', 'hover:bg-slate-200');
          btn.classList.remove('bg-emerald-600', 'text-white');
        }
      });
      
      renderProducts();
    }

    // Search Products
    function searchProducts(query) {
      searchQuery = query;
      renderProducts();
    }

    // Cart Functions
    async function addToCart(productId) {
      if (isLoading) return;
      
      const existingItem = cartItems.find(item => item.product_id === productId);
      
      if (existingItem) {
        isLoading = true;
        const result = await window.dataSdk.update({
          ...existingItem,
          quantity: existingItem.quantity + 1
        });
        isLoading = false;
        
        if (!result.isOk) {
          showToast('Gagal menambah item', 'error');
          return;
        }
      } else {
        if (cartItems.length >= 999) {
          showToast('Keranjang penuh! Maksimal 999 item.', 'error');
          return;
        }
        
        isLoading = true;
        const result = await window.dataSdk.create({
          product_id: productId,
          quantity: 1,
          added_at: new Date().toISOString()
        });
        isLoading = false;
        
        if (!result.isOk) {
          showToast('Gagal menambah item', 'error');
          return;
        }
      }
      
      const product = products.find(p => p.id === productId);
      showToast(`${product.name} ditambahkan ke keranjang!`, 'success');
    }

    async function updateQuantity(backendId, delta) {
      if (isLoading) return;
      
      const item = cartItems.find(i => i.__backendId === backendId);
      if (!item) return;
      
      const newQuantity = item.quantity + delta;
      
      if (newQuantity <= 0) {
        isLoading = true;
        await window.dataSdk.delete(item);
        isLoading = false;
      } else {
        isLoading = true;
        await window.dataSdk.update({ ...item, quantity: newQuantity });
        isLoading = false;
      }
    }

    async function removeFromCart(backendId) {
      if (isLoading) return;
      
      const item = cartItems.find(i => i.__backendId === backendId);
      if (!item) return;
      
      isLoading = true;
      await window.dataSdk.delete(item);
      isLoading = false;
      
      showToast('Item dihapus dari keranjang', 'info');
    }

    function toggleCart() {
      const overlay = document.getElementById('cart-overlay');
      const sidebar = document.getElementById('cart-sidebar');
      
      if (sidebar.classList.contains('translate-x-full')) {
        overlay.classList.remove('hidden');
        sidebar.classList.remove('translate-x-full');
        document.body.style.overflow = 'hidden';
      } else {
        overlay.classList.add('hidden');
        sidebar.classList.add('translate-x-full');
        document.body.style.overflow = '';
      }
    }

    function updateCartUI() {
      const cartCount = document.getElementById('cart-count');
      const cartItemsContainer = document.getElementById('cart-items');
      const cartEmpty = document.getElementById('cart-empty');
      const cartFooter = document.getElementById('cart-footer');
      
      const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
      
      if (totalItems > 0) {
        cartCount.textContent = totalItems;
        cartCount.classList.remove('hidden');
      } else {
        cartCount.classList.add('hidden');
      }
      
      if (cartItems.length === 0) {
        cartItemsContainer.classList.add('hidden');
        cartEmpty.classList.remove('hidden');
        cartFooter.classList.add('hidden');
        return;
      }
      
      cartItemsContainer.classList.remove('hidden');
      cartEmpty.classList.add('hidden');
      cartFooter.classList.remove('hidden');
      
      cartItemsContainer.innerHTML = cartItems.map(item => {
        const product = products.find(p => p.id === item.product_id);
        if (!product) return '';
        
        return `
          <div class="flex gap-3 p-3 bg-slate-50 rounded-xl mb-3">
            <div class="w-20 h-20 bg-gradient-to-br ${product.color} rounded-xl flex items-center justify-center text-3xl flex-shrink-0">
              ${product.image}
            </div>
            <div class="flex-1 min-w-0">
              <h4 class="font-semibold text-slate-800 text-sm line-clamp-2 mb-1">${product.name}</h4>
              <p class="font-bold text-emerald-600 text-sm mb-2">${formatPrice(product.price)}</p>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <button onclick="updateQuantity('${item.__backendId}', -1)" class="w-8 h-8 bg-white border border-slate-200 rounded-lg flex items-center justify-center hover:bg-slate-100 transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                    </svg>
                  </button>
                  <span class="w-8 text-center font-semibold">${item.quantity}</span>
                  <button onclick="updateQuantity('${item.__backendId}', 1)" class="w-8 h-8 bg-white border border-slate-200 rounded-lg flex items-center justify-center hover:bg-slate-100 transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                  </button>
                </div>
                <button onclick="removeFromCart('${item.__backendId}')" class="p-2 text-rose-500 hover:bg-rose-50 rounded-lg transition-all">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      updateTotals();
    }

    function updateTotals() {
      let subtotal = 0;
      
      cartItems.forEach(item => {
        const product = products.find(p => p.id === item.product_id);
        if (product) {
          subtotal += product.price * item.quantity;
        }
      });
      
      const shipping = subtotal >= 500000 ? 0 : 15000;
      const total = subtotal + shipping;
      
      document.getElementById('subtotal').textContent = formatPrice(subtotal);
      document.getElementById('shipping').textContent = shipping === 0 ? 'GRATIS' : formatPrice(shipping);
      document.getElementById('total').textContent = formatPrice(total);
    }

    // Checkout Functions
    function showCheckout() {
      if (cartItems.length === 0) return;
      
      const modal = document.getElementById('checkout-modal');
      const summary = document.getElementById('checkout-summary');
      const totalEl = document.getElementById('checkout-total');
      
      let subtotal = 0;
      
      summary.innerHTML = cartItems.map(item => {
        const product = products.find(p => p.id === item.product_id);
        if (!product) return '';
        
        const itemTotal = product.price * item.quantity;
        subtotal += itemTotal;
        
        return `
          <div class="flex justify-between">
            <span>${product.name} x${item.quantity}</span>
            <span>${formatPrice(itemTotal)}</span>
          </div>
        `;
      }).join('');
      
      const shipping = subtotal >= 500000 ? 0 : 15000;
      const total = subtotal + shipping;
      
      summary.innerHTML += `
        <div class="flex justify-between pt-2 border-t border-slate-200 mt-2">
          <span>Ongkos Kirim</span>
          <span>${shipping === 0 ? 'GRATIS' : formatPrice(shipping)}</span>
        </div>
      `;
      
      totalEl.textContent = formatPrice(total);
      
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeCheckout() {
      document.getElementById('checkout-modal').classList.add('hidden');
      document.body.style.overflow = '';
    }

    async function processCheckout(event) {
      event.preventDefault();
      
      const btn = document.getElementById('place-order-btn');
      const form = document.getElementById('checkout-form');
      const nameInput = form.querySelector('input[type="text"]');
      const phoneInput = form.querySelector('input[type="tel"]');
      const addressInput = form.querySelector('textarea');
      const paymentMethod = form.querySelector('input[name="payment"]:checked').value;
      
      btn.disabled = true;
      btn.textContent = 'Memproses...';
      
      // Simulate processing
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Generate order summary
      let orderText = `Halo, saya ingin melakukan pemesanan:\n\n`;
      orderText += `*DETAIL PEMESANAN*\n`;
      
      cartItems.forEach(item => {
        const product = products.find(p => p.id === item.product_id);
        if (product) {
          orderText += `â€¢ ${product.name}\n`;
          orderText += `  Jumlah: ${item.quantity}x\n`;
          orderText += `  Harga: ${formatPrice(product.price * item.quantity)}\n\n`;
        }
      });
      
      let subtotal = 0;
      cartItems.forEach(item => {
        const product = products.find(p => p.id === item.product_id);
        if (product) subtotal += product.price * item.quantity;
      });
      
      const shipping = subtotal >= 500000 ? 0 : 15000;
      const total = subtotal + shipping;
      
      orderText += `*RINGKASAN TOTAL*\n`;
      orderText += `Subtotal: ${formatPrice(subtotal)}\n`;
      orderText += `Ongkir: ${shipping === 0 ? 'GRATIS' : formatPrice(shipping)}\n`;
      orderText += `Total: ${formatPrice(total)}\n\n`;
      
      orderText += `*METODE PEMBAYARAN*\n`;
      const paymentNames = { transfer: 'Transfer Bank', ewallet: 'E-Wallet', cod: 'COD (Bayar di Tempat)' };
      orderText += `${paymentNames[paymentMethod]}\n\n`;
      
      orderText += `*DATA PENGIRIMAN*\n`;
      orderText += `Nama: ${nameInput.value}\n`;
      orderText += `Telepon: ${phoneInput.value}\n`;
      orderText += `Alamat: ${addressInput.value}`;
      
      // Get seller phone from config - normalize to international format
      const sellerPhoneNumber = window.elementSdk?.config?.seller_phone || defaultConfig.seller_phone;
      const cleanPhone = sellerPhoneNumber.replace(/\D/g, '');
      const internationalPhone = cleanPhone.startsWith('62') ? cleanPhone : '62' + cleanPhone.substring(1);
      
      // Try whatsapp:// protocol first, then fallback to web
      const whatsappDeepLink = `whatsapp://send?phone=${internationalPhone}&text=${encodeURIComponent(orderText)}`;
      const whatsappWebLink = `https://web.whatsapp.com/send?phone=${internationalPhone}&text=${encodeURIComponent(orderText)}`;
      
      closeCheckout();
      toggleCart();
      
      // Show success
      document.getElementById('success-modal').classList.remove('hidden');
      
      // Clear cart after showing success
      setTimeout(async () => {
        isLoading = true;
        for (const item of [...cartItems]) {
          await window.dataSdk.delete(item);
        }
        isLoading = false;
      }, 500);
      
      // Open WhatsApp - try deep link first, then fallback
      setTimeout(() => {
        const link = document.createElement('a');
        link.href = whatsappDeepLink;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        link.click();
        
        // Fallback after 2 seconds
        setTimeout(() => {
          window.open(whatsappWebLink, '_blank', 'noopener,noreferrer');
        }, 2000);
      }, 1000);
      
      btn.disabled = false;
      btn.textContent = 'Buat Pesanan';
      form.reset();
    }

    function closeSuccess() {
      document.getElementById('success-modal').classList.add('hidden');
      document.body.style.overflow = '';
    }

    // Product Detail Modal
    function showProductDetail(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 fade-in';
      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };

      const discount = getDiscount(product.originalPrice, product.price);
      
      modal.innerHTML = `
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90%] overflow-y-auto slide-in">
          <div class="sticky top-0 bg-white flex justify-between items-center p-4 border-b border-slate-200 z-10">
            <h2 class="text-lg font-bold text-slate-800">Detail Produk</h2>
            <button onclick="this.closest('.fade-in').remove()" class="p-2 hover:bg-slate-100 rounded-lg transition-all">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>

          <div class="p-6 space-y-4">
            <!-- Product Image -->
            <div class="relative">
              <img src="${product.photoUrl}" alt="${product.name}" loading="lazy" onerror="this.style.background='#e5e7eb'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.style.fontSize='4rem'; this.textContent='??';" class="w-full h-80 object-cover rounded-xl bg-gradient-to-br ${product.color}">
              <span class="absolute top-4 left-4 bg-rose-500 text-white px-3 py-1 rounded-full font-bold text-sm">-${discount}%</span>
            </div>

            <!-- Product Info -->
            <div>
              <h1 class="text-2xl font-bold text-slate-800 mb-2">${product.name}</h1>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-amber-500 text-lg">?</span>
                <span class="font-semibold text-slate-700">${product.rating}</span>
                <span class="text-slate-400">|</span>
                <span class="text-slate-600">${formatSold(product.sold)} terjual</span>
              </div>

              <div class="bg-slate-50 p-4 rounded-xl mb-4">
                <p class="text-slate-600 leading-relaxed">${product.description}</p>
              </div>

              <!-- Price -->
              <div class="flex items-baseline gap-3 mb-4">
                <span class="text-3xl font-bold text-emerald-600">${formatPrice(product.price)}</span>
                <span class="text-lg text-slate-400 line-through">${formatPrice(product.originalPrice)}</span>
              </div>

              <!-- Actions -->
              <div class="flex gap-3">
                <button onclick="event.stopPropagation(); addToCart('${product.id}'); this.closest('.fade-in').remove();" class="flex-1 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl font-bold hover:shadow-lg hover:scale-[1.02] transition-all">
                  Tambah ke Keranjang
                </button>
                <button onclick="this.closest('.fade-in').remove()" class="flex-1 py-3 border-2 border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition-all">
                  Tutup
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const colors = {
        success: 'bg-emerald-600',
        error: 'bg-rose-600',
        info: 'bg-blue-600'
      };
      
      const icons = {
        success: '?',
        error: '?',
        info: '?'
      };
      
      toast.className = `toast ${colors[type]} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2 pointer-events-auto`;
      toast.innerHTML = `
        <span class="w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-sm">${icons[type]}</span>
        <span class="font-medium text-sm">${message}</span>
      `;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Initialize
    async function init() {
      if (window.elementSdk) {
        window.elementSdk.init(element);
      }
      
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }
      
      renderProducts();
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d4615f2779a5fa2',t:'MTc3MjE3ODU2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
